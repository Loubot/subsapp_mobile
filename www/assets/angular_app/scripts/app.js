// Generated by CoffeeScript 1.10.0
window.logged_in_user = null;

'use strict';

angular.module('subzapp_mobile', ['ngAnimate', 'ui.router', 'ngRoute']);

angular.module('subzapp_mobile').constant('API', 'api/v1/');

angular.module('subzapp_mobile').config(function($stateProvider, $urlRouterProvider) {
  $urlRouterProvider.otherwise("/");
  return $stateProvider.state("login", {
    url: "/",
    templateUrl: 'assets/angular_app/views/login/login.html',
    controller: "LoginController"
  });
});

angular.module('subzapp_mobile').constant('RESOURCES', (function() {
  var url;
  console.log("url " + window.location.origin);
  url = window.location.origin;
  return {
    DOMAIN: url
  };
})());

angular.module('subzapp_mobile').factory('message', function() {
  return {
    error: function(mes) {
      $('.login_error').text(mes);
      return $('.login_error').show('slide', {
        direction: 'right'
      }, 1000);
    }
  };
});

angular.module('subzapp_mobile').service('user', function($http, $state, RESOURCES) {
  console.log("user service");
  return {
    get_user: function() {
      var id, user_token;
      console.log("yyyyyyyyyyyyyyyyyyy");
      user_token = window.localStorage.getItem('user_token');
      id = window.localStorage.getItem('user_id');
      return $http({
        method: 'GET',
        url: RESOURCES.DOMAIN + "/user/" + id,
        headers: {
          'Authorization': "JWT " + user_token,
          "Content-Type": "application/json"
        }
      }).success(function(data) {
        console.log("Fetched user data " + (JSON.stringify(data)));
        if (!(data != null)) {
          $state.go('login');
          console.log("No user data");
          return false;
        } else {
          window.USER = data;
          return data;
        }
      }).error(function(err) {
        console.log("Fetching user data error " + (JSON.stringify(err)));
        return $state.go('login');
      });
    }
  };
});

window.init = function() {
  return console.log("Hello");
};
